/*
 Leanplum Javascript SDK v1.1.4.
 Copyright 2014, Leanplum, Inc. All rights reserved.
*/
(function(){function r(a,b,d,q){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof m&&(a=a.ra);b instanceof m&&(b=b.ra);var e=Object.prototype.toString.call(a);if(e!=Object.prototype.toString.call(b))return!1;switch(e){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&
a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var g=d.length;g--;)if(d[g]==a)return q[g]==b;d.push(a);q.push(b);var g=0,k=!0;if("[object Array]"==e){if(g=a.length,k=g==b.length)for(;g--&&(k=r(a[g],b[g],d,q)););}else{var e=a.constructor,h=b.constructor;if(e!==h&&!(m.X(e)&&e instanceof e&&m.X(h)&&h instanceof h))return!1;for(var f in a)if(m.D(a,f)&&(g++,!(k=m.D(b,f)&&r(a[f],b[f],d,q))))break;if(k){for(f in b)if(m.D(b,f)&&!g--)break;k=!g}}d.pop();q.pop();return k}
function s(){this.C=this.B=!1}function n(){this.i="";this.T={}}function m(){}var e={};this.Leanplum||(this.Leanplum=e);var t="https://www.leanplum.com/api",u="dev.leanplum.com",v=10,b={J:!0,Q:[],P:function(a,b,d){d(prompt(a,b))},o:[],h:[],H:{},A:"",I:!0,r:5};e.setApiPath=function(a){t=a};e.setEmail=function(a){b.ga=a};e.setUpdateCheckingEnabledInDevelopmentMode=function(a){b.J=a};e.setNetworkTimeout=function(a){v=a};e.setAppIdForDevelopmentMode=function(a,c){b.q=a;b.u=c;b.k=!0};e.setAppIdForProductionMode=
function(a,c){b.q=a;b.u=c;b.k=!1};e.setSocketHost=function(a){u=a};e.setDeviceId=function(a){b.l=a};e.setAppVersion=function(a){b.qa=a};e.setDeviceName=function(a){b.fa=a};e.setDeviceModel=function(a){b.ea=a};e.setSystemName=function(a){b.oa=a};e.setSystemVersion=function(a){b.pa=a};e.setVariables=function(a){b.S=a;if(b.k){var c={};c.vars=a;b.d("setVars",(new n).body(JSON.stringify(c)),{j:!0})}};e.setRequestBatching=function(a,c){b.I=a;b.r=c};e.getVariables=function(){return void 0!==b.O?b.O:b.S};
e.getVariable=function(a){for(var b=e.getVariables,d=0;d<arguments.length;d++)b=b[arguments[d]];return b};e.addStartResponseHandler=function(a){b.h.push(a);b.M&&a(b.n)};e.addVariablesChangedHandler=function(a){b.o.push(a);b.ka&&a()};e.removeStartResponseHandler=function(a){a=b.h.indexOf(a);0<=a&&b.h.splice(a,1)};e.removeVariablesChangedHandler=function(a){a=b.o.indexOf(a);0<=a&&b.o.splice(a,1)};e.start=function(a,c,d){"function"==typeof a?(d=a,c={},a=null):"object"==typeof a&&null!==a&&void 0!==a?
(d=c,c=a,a=null):"function"==typeof c&&(d=c,c={});b.f=a;d&&e.addStartResponseHandler(d);b.d("start",(new n).add("userAttributes",JSON.stringify(c)).add("country","(detect)").add("region","(detect)").add("city","(detect)").add("location","(detect)").add("systemName",b.oa||p.ba).add("systemVersion",""+(b.pa||"")).add("browserName",p.V).add("browserVersion",""+p.version).add("locale","(detect)").add("deviceName",b.fa||p.V+" "+p.version).add("deviceModel",b.ea||"Web Browser").add("includeDefaults",!1),
{e:!0,j:!0,response:function(a){b.M=!0;a=b.w(a);if(b.N(a)){b.n=!0;if(b.k){a.latestVersion&&b.J&&alert("A newer version of Leanplum is available. Go to leanplum.com to download it.\n\nYou can turn off this notification by calling Leanplum setUpdateCheckingEnabledInDevelopmentMode(false).");if(!a.isRegistered){var c=b.ga,d=!0,e=function(a){a&&b.d("registerDevice",(new n).add("email",a),{j:!0,response:function(a){a=b.w(a);a=b.N(a)?"Thank You! Your device has been registered.":(b.ja(a)||"Unable to register device.")+
" Please try again later.";d?console.log(a):alert(a)}})};void 0===c?(d=!1,b.P("Welcome to Leanplum! Please enter your Leanplum email address to register your device for development.","myself@gmail.com",e)):e(c)}WebSocket?b.R():console.log("Your browser doesn't support WebSockets.")}b.F(a.vars,a.actionMetadata);b.A=a.token}else b.n=!1,b.Y();for(a=0;a<b.h.length;a++)b.h[a](b.n)}})};e.startFromCache=function(a,c,d){"function"==typeof a?(d=a,a=null):"object"==typeof a&&null!==a&&void 0!==a?(d=c,a=null):
"function"==typeof c&&(d=c);b.f=a;d&&e.addStartResponseHandler(d);b.M=!0;b.n=!0;b.k&&(WebSocket?b.R():console.log("Your browser doesn't support WebSockets."));b.Y();for(a=0;a<b.h.length;a++)b.h[a](b.n)};b.R=function(){var a=new s,c=!1;a.onopen=function(){if(!c){console.log("Leanplum: Connected to development server.");var d={};d.appId=b.q;a.ua(d);c=!0}};a.onerror=function(a){console.log("Leanplum: Socket error",a)};a.onmessage=function(a){"updateVars"==a&&b.d("getVars",(new n).add("includeDefaults",
!1),{e:!1,j:!0,response:function(a){a=b.w(a).vars;m.isEqual(a,b.L)||b.F(a)}})};a.onclose=function(){console.log("Leanplum: Disconnected to development server.");c=!1};a.W();setInterval(function(){a.B||a.C||a.W()},5E3)};e.setPromptFunction=function(a){b.P=a};e.stop=function(){b.d("stop",void 0,{j:!0,e:!0})};e.pauseSession=function(){b.d("pauseSession",void 0,{j:!0,e:!0})};e.resumeSession=function(){b.d("resumeSession",void 0,{j:!0,e:!0})};e.pauseState=function(){b.d("pauseState",void 0,{e:!0})};e.resumeState=
function(){b.d("resumeState",void 0,{e:!0})};e.setUserAttributes=function(a,c){void 0===c&&(c=a,a=null);b.d("setUserAttributes",(new n).add("userAttributes",JSON.stringify(c)).add("newUserId",a),{e:!0});a&&(b.f=a,localStorage.__leanplum_user_id=b.f)};e.track=function(a,c,d,e){"object"==typeof c&&null!==c&&void 0!==c?(e=c,c=d=void 0):"string"==typeof c?(e=d,d=c,c=void 0):"object"==typeof d&&(null!==d&&void 0!==d)&&(e=d,d=void 0);b.d("track",(new n).add("event",a).add("value",c||0).add("info",d).add("params",
JSON.stringify(e)),{e:!0})};e.advanceTo=function(a,c,d){"object"==typeof c&&(null!==c&&void 0!==c)&&(d=c,c=void 0);b.d("advance",(new n).add("state",a).add("info",c).add("params",JSON.stringify(d)),{e:!0})};b.F=function(a,c){b.L=a;b.H=c;b.ka=!0;b.O=b.G(b.S,a);b.xa();for(var d=0;d<b.o.length;d++)b.o[d]()};b.G=function(a,c){function d(a){return function(b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c]);else for(c in a)b(c)}}if("number"==typeof c||"boolean"==typeof c||"string"==typeof c)return c;
if(null===c||void 0===c)return a;var e=d(a),l=d(c),g=!1;if(null==a&&!(c instanceof Array)){var g=null,k;for(k in c){null===g&&(g=!0);if("string"!=typeof k){g=!1;break}if(3>k.length||"["!=k.charAt(0)||"]"!=k.charAt(k.length-1)){g=!1;break}var h=k.substring(1,k.length-1);if(!(""+parseInt(h))==h){g=!1;break}}}if(a instanceof Array||g){var f=[];e(function(a){f.push(a)});l(function(a){var d=parseInt(a.substring(1,a.length-1));for(a=c[a];d>=f.length;)f.push(null);f[d]=b.G(f[d],a)});return f}f={};e(function(b){if(null===
c[b]||void 0===c[b])f[b]=a[b]});l(function(d){f[d]=b.G(null!=a?a[d]:null,c[d])});return f};b.Y=function(){try{b.F(JSON.parse(localStorage.__leanplum_variables),JSON.parse(localStorage.__leanplum_action_metadata)),b.A=localStorage.__leanplum_token}catch(a){console.log("Leanplum: Invalid diffs: "+a)}};b.xa=function(){localStorage.__leanplum_variables=JSON.stringify(b.L||{});localStorage.__leanplum_action_metadata=JSON.stringify(b.H||{});localStorage.__leanplum_token=b.A};b.na=function(a){var b=localStorage.__leanplum_unsynced||
0;localStorage["__leanplum_unsynced_"+b]=JSON.stringify(a);b++;localStorage.__leanplum_unsynced=b};b.ma=function(){var a=[],b=localStorage.__leanplum_unsynced||0;localStorage.removeItem("__leanplum_unsynced");for(var d=0;d<b;d++){var e="__leanplum_unsynced_"+d;try{var l=JSON.parse(localStorage[e]);a.push(l)}catch(g){}localStorage.removeItem(e)}return a};b.d=function(a,c,d){d=d||{};c=c||new n;b.l||(b.l=localStorage.__leanplum_device_id);if(!b.l){for(var e="",l=0;16>l;l++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*
Math.random()));b.l=e;localStorage.__leanplum_device_id=e}b.f||(b.f=localStorage.__leanplum_user_id,b.f||(b.f=b.l));localStorage.__leanplum_user_id=b.f;a=c.U().add("sdkVersion","1.1.4").add("deviceId",b.l).add("userId",b.f).add("action",a).add("versionName",b.qa).add("devMode",b.k).add("time",""+(new Date).getTime()/1E3);var g=d.za||d.response,k=d.error||d.response;if(b.q&&b.u)if(c.body())b.p("POST",t+"?"+a.i,c.body(),g,k,d.e);else{c=b.k||d.j||!b.I;var h=function(){var a=b.ma();if(0<a.length){var a=
JSON.stringify({data:a}),c=(new n).U().add("sdkVersion","1.1.4").add("action","multi").add("time",""+(new Date).getTime()/1E3).i;b.p("POST",t+"?"+c,a,g,k,d.e)}};!c&&b.r&&(e=(new Date).getTime()/1E3,!b.s||e-b.s>=b.r?(c=!0,b.s=e):b.K||(b.K=setTimeout(function(){b.K=null;b.s=(new Date).getTime()/1E3;h()},1E3*(b.r-(e-b.s)))));b.na(a.T);c&&h()}else console.error("Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls."),
k&&k("Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.")};b.la=function(a){return a&&a.response?a.response.length:0};b.ia=function(a,b){return a&&a.response?a.response[b]:null};b.w=function(a){var c=b.la(a);return 0<c?b.ia(a,c-1):null};b.N=function(a){return a?a.success?!0:!1:!1};b.ja=function(a){return a?(a=a.error)?a.message:null:null};n.prototype.add=function(a,b){if("undefined"===typeof b)return this;
this.i&&(this.i+="&");this.i+=a+"="+encodeURIComponent(b);this.T[a]=b;return this};n.prototype.body=function(a){return a?(this.da=a,this):this.da};n.prototype.U=function(){return this.add("appId",b.q).add("client","js").add("clientKey",b.u)};s.prototype.ua=function(a){this.g.send("5:::"+JSON.stringify({name:"auth",args:a}))};s.prototype.W=function(){var a=this;a.C=!0;b.p("POST","http://"+u+"/socket.io/1","",function(b){b=b.split(":");var d=1E3*(parseInt(b[1])/2);a.g=new WebSocket("ws://"+u+"/socket.io/1/websocket/"+
b[0]);var e=null;a.g.onopen=function(){a.B=!0;a.C=!1;if(a.onopen)a.onopen();e=setInterval(function(){a.g.send("2:::")},d)};a.g.onclose=function(){a.B=!1;clearInterval(e);if(a.onclose)a.onclose()};a.g.onmessage=function(b){var c=b.data.split(":"),d=parseInt(c[0]);if(2==d)a.g.send("2::");else if(5==d){if(d=c[1],c=JSON.parse(c.slice(3).join(":")),b=c.name,c=c.args,d&&a.g.send("6:::"+d),a.onmessage)a.onmessage(b,c)}else 7==d&&console.log("Socket error: "+b.data)};a.g.onerror=function(b){a.g.close();if(a.onerror)a.onerror(b)}},
null,!1,!0)};b.ca=function(a,c,d,e,l,g,k){var h=new XDomainRequest;h.onload=function(){var a,c=!1;if(k)a=h.responseText;else try{a=JSON.parse(h.responseText)}catch(d){setTimeout(function(){l&&l(null,h)},0),c=!0}c||setTimeout(function(){e&&e(a,h)},0);g&&(b.t=!1,b.v())};h.onerror=h.ontimeout=function(){setTimeout(function(){l&&l(null,h)},0);g&&(b.t=!1,b.v())};h.onprogress=function(){};h.open(a,c);h.timeout=1E3*v;h.send(d)};b.ha=function(a){b.Q.push(a)};b.v=function(){var a=b.Q.shift();a&&b.p.apply(null,
a)};b.p=function(a,c,d,e,l,g,k){if(g){if(b.t)return b.ha(arguments);b.t=!0}if("undefined"!==typeof XDomainRequest)return"http:"===location.protocol&&0==c.indexOf("https:")&&(c="http:"+c.substring(6)),b.ca.apply(null,arguments);var h=!1,f=new XMLHttpRequest;f.onreadystatechange=function(){if(4===f.readyState&&!h){h=!0;var a,c=!1;if(k)a=f.responseText;else try{a=JSON.parse(f.responseText)}catch(d){setTimeout(function(){l&&l(null,f)},0),c=!0}c||(200<=f.status&&300>f.status?setTimeout(function(){e&&e(a,
f)},0):setTimeout(function(){l&&l(a,f)},0));g&&(b.t=!1,b.v())}};f.open(a,c,!0);f.setRequestHeader("Content-Type","text/plain");f.send(d);setTimeout(function(){h||f.abort()},1E3*v)};m.ya=function(a){each(slice.call(arguments,1),function(b){for(var d in b)a[d]=b[d]});return a};m.X=function(a){return"function"===typeof a};m.D=function(a,b){return hasOwnProperty.call(a,b)};m.isEqual=function(a,b){return r(a,b,[],[])};var p={va:function(){this.V=this.Z(this.sa)||"An unknown browser";this.version=this.$(navigator.userAgent)||
this.$(navigator.appVersion)||"an unknown version";this.ba=this.Z(this.ta)||"an unknown OS"},Z:function(a){for(var b=0;b<a.length;b++){var d=a[b].b,e=a[b].wa;this.aa=a[b].m||a[b].a;if(d){if(-1!=d.indexOf(a[b].c))return a[b].a}else if(e)return a[b].a}},$:function(a){var b=a.indexOf(this.aa);if(-1!=b)return parseFloat(a.substring(b+this.aa.length+1))},sa:[{b:navigator.userAgent,c:"Chrome",a:"Chrome"},{b:navigator.userAgent,c:"OmniWeb",m:"OmniWeb/",a:"OmniWeb"},{b:navigator.vendor,c:"Apple",a:"Safari",
m:"Version"},{wa:window.opera,a:"Opera",m:"Version"},{b:navigator.vendor,c:"iCab",a:"iCab"},{b:navigator.vendor,c:"KDE",a:"Konqueror"},{b:navigator.userAgent,c:"Firefox",a:"Firefox"},{b:navigator.vendor,c:"Camino",a:"Camino"},{b:navigator.userAgent,c:"Netscape",a:"Netscape"},{b:navigator.userAgent,c:"MSIE",a:"Explorer",m:"MSIE"},{b:navigator.userAgent,c:"Gecko",a:"Mozilla",m:"rv"},{b:navigator.userAgent,c:"Mozilla",a:"Netscape",m:"Mozilla"}],ta:[{b:navigator.platform,c:"Win",a:"Windows"},{b:navigator.platform,
c:"Mac",a:"Mac OS"},{b:navigator.userAgent,c:"iPhone",a:"iPhone OS"},{b:navigator.platform,c:"Linux",a:"Linux"}]};p.va()}).call(this);
